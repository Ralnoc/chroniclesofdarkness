<?xml version="1.0" encoding="iso-8859-1"?>

<!-- This file is provided under the Open Game License version 1.0a
     For more information on OGL and related issues, see 
       http://www.wizards.com/d20
    
     All producers of work derived from this definition are adviced to
     familiarize themselves with the above license, and to take special
     care in providing the definition of Product Identity (as specified
     by the OGL) in their products.
    
     Copyright 2009 SmiteWorks Ltd.
  -->

<root version="2.0">
  <windowclass name="referencetext">
    <frame>referencebox</frame>
    <placement>
      <size>
        <width>400</width>
        <height>650</height>
      </size>
    </placement>
    <sizelimits>
      <dynamic />
    </sizelimits>
    <minimize>minimized_reference</minimize>
    <tooltip>
      <field>name</field>
    </tooltip>
    <sheetdata>
      <CloseBox>
        <position>-12,1</position>
      </CloseBox>
      <windowreferencecontrol>
        <bounds>20,18,20,20</bounds>
        <icon>
          <normal>button_openwindow</normal>
        </icon>
        <class>story</class>
        <description>
          <field>name</field>
        </description>
      </windowreferencecontrol>
      <stringfield name="name">
        <bounds>45,22,-25,20</bounds>
        <font>sheetlabel</font>
      </stringfield>
      <formattedtextfield name="text">
        <bounds>25,44,-25,-14</bounds>
        <font>
          <normal>chatfont</normal>
          <bold>narratorfont</bold>
          <italic>chatitalicfont</italic>
          <bolditalic>chatbolditalicfont</bolditalic>
          <title>sheetlabel</title>
        </font>
        <linkicon>
          <link>button_openwindow</link>
          <emptylink>button_emptytarget</emptylink>
        </linkicon>
        <footer>footer_wide</footer>
        <selectioncolor>#FFD296</selectioncolor>
      </formattedtextfield>
      <scrollercontrol>
        <anchored>
          <to>text</to>
          <position>insidebottomright</position>
        </anchored>
        <target>text</target>
        <button>
          <normal>button_scroller</normal>
          <pressed>button_scroller_down</pressed>
        </button>
      </scrollercontrol>
    </sheetdata>
  </windowclass>

  <windowclass name="referencetextwide">
    <frame>referencebox</frame>
    <placement>
      <size>
        <width>650</width>
        <height>650</height>
      </size>
    </placement>
    <sizelimits>
      <dynamic>
        <resize>vertical</resize>
      </dynamic>
    </sizelimits>
    <minimize>minimized_reference</minimize>
    <tooltip>
      <field>name</field>
    </tooltip>
    <sheetdata>
      <CloseBox>
        <position>-12,1</position>
      </CloseBox>
      <windowreferencecontrol>
        <bounds>20,18,20,20</bounds>
        <icon>
          <normal>button_openwindow</normal>
        </icon>
        <class>referencetextwide</class>
        <description>
          <field>name</field>
        </description>
      </windowreferencecontrol>
      <stringfield name="name">
        <bounds>45,22,-25,20</bounds>
        <font>sheetlabel</font>
      </stringfield>
      <formattedtextfield name="text">
        <bounds>25,44,-25,-14</bounds>
        <font>
          <normal>chatfont</normal>
          <bold>narratorfont</bold>
          <italic>chatitalicfont</italic>
          <bolditalic>chatbolditalicfont</bolditalic>
          <title>sheetlabel</title>
        </font>
        <linkicon>
          <link>button_openwindow</link>
          <emptylink>button_emptytarget</emptylink>
        </linkicon>
        <footer>footer_wide</footer>
        <selectioncolor>#FFD296</selectioncolor>
      </formattedtextfield>
      <scrollercontrol>
        <anchored>
          <to>text</to>
          <position>insidebottomright</position>
        </anchored>
        <target>text</target>
        <button>
          <normal>button_scroller</normal>
          <pressed>button_scroller_down</pressed>
        </button>
      </scrollercontrol>
    </sheetdata>
  </windowclass>

  <!-- Generic lists -->
  <windowclass name="referenceindexitem">
    <sizelimits>
      <minimum>
        <height>20</height>
      </minimum>
    </sizelimits>
    <sheetdata>
      <windowreferencefield name="listlink">
        <bounds>0,0,20,20</bounds>
        <icon>
          <normal>button_openwindow</normal>
          <pressed>button_emptytarget</pressed>
        </icon>
        <description>
          <field>name</field>
        </description>
      </windowreferencefield>
      <staticlinkstringfield name="name">
        <bounds>25,4,-1,15</bounds>
        <font>sheetlabel</font>
        <linktarget>listlink</linktarget>
      </staticlinkstringfield>
    </sheetdata>
  </windowclass>

  <windowclass name="referenceindexcontent">
    <sizelimits>
      <minimum>
        <height>20</height>
      </minimum>
      <maximum>
        <height>10000</height>
      </maximum>
    </sizelimits>
    <sheetdata>
      <stringfield name="name">
        <bounds>0,10,-1,20</bounds>
        <font>sheetlabel</font>
        <center />
        <nodrag />
      </stringfield>
      <formattedtextfield name="description">
        <anchored>
          <to>name</to>
          <position>below</position>
        </anchored>
        <font>
          <normal>chatfont</normal>
          <bold>narratorfont</bold>
          <italic>chatitalicfont</italic>
          <bolditalic>chatbolditalicfont</bolditalic>
          <title>sheetlabel</title>
        </font>
        <linkicon>
          <link>button_openwindow</link>
          <emptylink>button_emptytarget</emptylink>
        </linkicon>
        <selectioncolor>#FFD296</selectioncolor>
        <script>
          function onInit()
            if isEmpty() then
              setVisible(false);
            end
          end
        </script>
      </formattedtextfield>
      <windowlist name="index">
        <anchored>
          <to>description</to>
          <position>below</position>
          <right>
            <parent>name</parent>
            <anchor>right</anchor>
          </right>
        </anchored>
        <datasource>.index</datasource>
        <class>referenceindexitem</class>
        <noscroll />
      </windowlist>
    </sheetdata>
  </windowclass>

  <windowclass name="referenceindex">
    <frame>referencebox</frame>
    <placement>
      <size>
        <width>350</width>
        <height>450</height>
      </size>
    </placement>
    <sizelimits>
      <dynamic />
    </sizelimits>
    <minimize>minimized_reference</minimize>
    <tooltip>
      <field>name</field>
    </tooltip>
    <sheetdata>
      <subwindow name="content">
        <class>referenceindexcontent</class>
        <bounds>20,9,-22,-14</bounds>
        <activate />
      </subwindow>
      <CloseBox>
        <position>-12,1</position>
      </CloseBox>
      <scrollercontrol>
        <anchored>
          <to>content</to>
          <position>insidebottomright</position>
        </anchored>
        <target>content</target>
        <button>
          <normal>button_scroller</normal>
          <pressed>button_scroller_down</pressed>
        </button>
      </scrollercontrol>
    </sheetdata>
  </windowclass>

  <!-- Inline text list -->
  <windowclass name="referenceinlineindexitem">
    <sizelimits>
      <minimum>
        <height>20</height>
      </minimum>
      <maximum>
        <height>10000</height>
      </maximum>
    </sizelimits>
    <script>
      local expand = false;
      local hide = false;
          
      function refresh()
        local state = getState();
        if state==2 then
          --[[ fixed, no widget needed ]]
          widget.setVisible(false);
        else
          --[[ expandable, show widget ]]
          widget.setVisible(true);
          if state==1 then
            --[[ expanded ]]
            widget.setIcon("button_collapse");
          else
            --[[ collapsed ]]
            widget.setIcon("button_expand");
          end
        end
      end
          
      function onInit()
        local node = getDatabaseNode();
        if node and node.getChild("expand") then
          expand = true;
          text.setVisible(true);
          if name.getValue()=="" then
            name.setVisible(false);
            widget.setVisible(false);
          end
        end
        if node and node.getChild("hide") then
          hide = true;
        end
        refresh();
      end
      
      function isHidden()
        return hide;
      end
      
      function toggleText()
        text.setVisible((not text.isVisible()) or expand);
        refresh();
      end
      
      function getState()
        if expand then
          return 2; --[[ Fixed ]]
        elseif text.isVisible() then
          return 1; --[[ Expanded ]]
        else
          return 0; --[[ Collapsed ]]
        end
      end
    </script>
    <sheetdata>
      <genericcontrol name="topanchor">
        <bounds>0,0,-1,1</bounds>
      </genericcontrol>
      <stringfield name="name">
        <anchored>
          <left>
            <anchor>left</anchor>
          </left>
          <top>
            <parent>topanchor</parent>
            <anchor>bottom</anchor>
            <offset>3</offset>
            <relation>relative</relation>
          </top>
          <size>
            <height>15</height>
          </size>
        </anchored>
        <font>sheetlabel</font>
        <static />
        <script>
          function onClickDown(button, x, y)
            window.toggleText();
          end
        </script>
      </stringfield>
      <genericcontrol name="widget">
        <anchored>
          <to>name</to>
          <position>righthigh</position>
          <offset>1,1</offset>
          <size>
            <width>12</width>
            <height>11</height>
          </size>
        </anchored>
        <script>
          function onClickDown(button, x, y)
            window.toggleText();
          end
        </script>
      </genericcontrol>
      <formattedtextfield name="text">
        <anchored>
          <left>
            <anchor>left</anchor>
          </left>
          <right>
            <anchor>right</anchor>
          </right>
          <top>
            <parent>topanchor</parent>
            <anchor>bottom</anchor>
            <offset>3</offset>
            <relation>relative</relation>
          </top>
        </anchored>
        <invisible />
        <font>
          <normal>chatfont</normal>
          <bold>narratorfont</bold>
          <italic>chatitalicfont</italic>
          <bolditalic>chatbolditalicfont</bolditalic>
          <title>sheetlabel</title>
        </font>
        <linkicon>
          <link>button_openwindow</link>
          <emptylink>button_emptytarget</emptylink>
        </linkicon>
        <selectioncolor>#FFD296</selectioncolor>
      </formattedtextfield>
    </sheetdata>
  </windowclass>

  <windowclass name="referenceinlineindex">
    <frame>referencebox</frame>
    <placement>
      <size>
        <width>300</width>
        <height>450</height>
      </size>
    </placement>
    <sizelimits>
      <dynamic />
    </sizelimits>
    <minimize>minimized_reference</minimize>
    <tooltip>
      <field>description</field>
    </tooltip>
    <sheetdata>
      <CloseBox>
        <position>-12,1</position>
      </CloseBox>
      <stringfield name="name">
        <bounds>25,20,-25,20</bounds>
        <font>sheetlabel</font>
        <center />
        <nodrag />
      </stringfield>
      <windowlist name="index">
        <bounds>20,40,-20,-14</bounds>
        <datasource>.index</datasource>
        <class>referenceinlineindexitem</class>
        <script>
          function onSortCompare(w1, w2)
            local id1 = w1.getDatabaseNode().getName();
            local id2 = w2.getDatabaseNode().getName();
            return (id1 &gt; id2);
          end
        </script>
      </windowlist>
      <scrollercontrol>
        <anchored>
          <to>index</to>
          <position>insidebottomright</position>
        </anchored>
        <target>index</target>
        <button>
          <normal>button_scroller</normal>
          <pressed>button_scroller_down</pressed>
        </button>
      </scrollercontrol>
    </sheetdata>
  </windowclass>
</root>
