<?xml version="1.0" encoding="iso-8859-1"?>
<root version="2.0">

  <icon name="title_effects" file="icons/title_items.png" />

  <windowclass name="effect">
    <sizelimits>
      <minimum>
        <height>20</height>
      </minimum>
    </sizelimits>
    <script>
      function onDrag(button, x, y, draginfo)
        if adjustment.getValue()~=0 and (not draginfo.isType("effect")) then
          draginfo.setType("effect");
          draginfo.setDescription(label.getValue());
          draginfo.setSlot(1);
          draginfo.setNumberData(duration.getValue());
          draginfo.setSlot(2);
          draginfo.setNumberData(adjustment.getValue());
          return true;
        end
      end
    </script>
    <sheetdata>
      <stringfield name="label">
        <bounds>0,2,-60,17</bounds>
        <empty>&#171; New Effect &#187;</empty>
        <font>sheettextsmall</font>
        <frame>
          <name>textline</name>
          <offset>0,1,0,0</offset>
        </frame>
        <tabtarget>
          <next>duration</next>
          <prev>adjustment</prev>
        </tabtarget>
        <font>sheettext</font>
        <script>
          function onDrag(...)
            return window.onDrag(...);
          end
        </script>
      </stringfield>
      <numberfield name="duration">
        <anchored>
          <to>label</to>
          <position>righthigh</position>
          <size>
            <width>30</width>
            <height>22</height>
          </size>
        </anchored>
        <font>sheetnumbersmall</font>
        <frame>
          <name>bonus</name>
          <offset>2,2,2,1</offset>
        </frame>
        <keyeditframe>
          <name>sheetfocus</name>
          <offset>2,2,2,2</offset>
        </keyeditframe>
        <tabtarget>
          <next>adjustment</next>
          <prev>label</prev>
        </tabtarget>
        <script>
          function onDrag(...)
            return window.onDrag(...);
          end
        </script>
      </numberfield>
      <numberfield name="adjustment">
        <anchored>
          <to>duration</to>
          <position>righthigh</position>
          <offset>0,0</offset>
          <size>
            <width>30</width>
            <height>22</height>
          </size>
        </anchored>
        <displaysign/>
        <font>sheetnumbersmall</font>
        <frame>
          <name>durationadjustment</name>
          <offset>2,2,2,2</offset>
        </frame>
        <keyeditframe>
          <name>sheetfocus</name>
          <offset>2,2,2,2</offset>
        </keyeditframe>
        <tabtarget>
          <next>label</next>
          <prev>duration</prev>
        </tabtarget>
        <script>
          function onDrag(...)
            return window.onDrag(...);
          end
        </script>
      </numberfield>
    </sheetdata>
  </windowclass>

  <windowclass name="effectlist">
    <frame>scrollbox</frame>
    <dynamic />
    <nodelete/>
    <placement>
      <size>
        <width>275</width>
        <height>350</height>
      </size>
    </placement>
    <sizelimits>
      <dynamic />
      <minimum>
        <width>200</width>
        <height>220</height>
      </minimum>
    </sizelimits>
    <softclose />
    <sheetdata>
      <CloseBox>
        <position>-13,5</position>
      </CloseBox>
      <genericcontrol>
        <bounds>15,15,30,157</bounds>
        <icon>title_effects</icon>
      </genericcontrol>
      <windowlist name="list">
        <bounds>50,25,-30,-34</bounds>
        <class>effect</class>
        <footer>footer_narrow</footer>
        <datasource>.</datasource>
        <skipempty/>
        <allowcreate/>
        <allowdelete/>
        <script>
          function onDrop(x,y,dragdata)
            if dragdata.isType("effect") then
              local duration;
              local adjustment;
              local label = dragdata.getDescription();
              dragdata.setSlot(1);
              duration = dragdata.getNumberData();
              dragdata.setSlot(2);
              adjustment = dragdata.getNumberData();
              addEntry(label,duration,adjustment);
            end
          end
          
          function addEntry(label,duration,adjustment)
            label = label or "";
            duration = duration or 0;
            adjustment = adjustment or 0;
            local win = createWindow();
            win.label.setValue(label);
            win.duration.setValue(duration);
            win.adjustment.setValue(adjustment);
          end
          
          function onFilter(w)
            local f = string.lower(window.filter.getValue());
            if f == "" then
              return true;
            end
            if string.find(string.lower(w.label.getValue()), f, 0, true) then
              return true;
            end
            return false;
          end
        </script>
      </windowlist>
      <scrollercontrol>
        <bounds>-105,-61,45,27</bounds>
        <target>list</target>
        <button>
          <normal>button_scroller</normal>
          <pressed>button_scroller_down</pressed>
        </button>
      </scrollercontrol>
      <buttoncontrol>
        <bounds>-55,-58,68,50</bounds>
        <icon>
          <normal>button_newwindow</normal>
          <pressed>button_newwindowdown</pressed>
        </icon>
        <class>effect</class>
        <script>
					function onButtonPress()
            window.list.addEntry();
					end
        </script>
      </buttoncontrol>
      <filter name="filter">
        <bounds>55,-70,-50,20</bounds>
        <target>list</target>
        <trigger>filtertrigger</trigger>
      </filter>
      <filtertrigger name="filtertrigger">
        <bounds>20,-85,21,41</bounds>
        <target>filter</target>
      </filtertrigger>
    </sheetdata>
  </windowclass>

</root>
